{
  "module": "auth",
  "version": "1.0.0",
  "layer": "infrastructure",
  "description": "Authentication and authorization for HIPAA-compliant access control",

  "exports": {
    "User": {
      "type": "interface",
      "properties": {
        "id": {
          "type": "string",
          "required": true,
          "annotations": []
        },
        "email": {
          "type": "string",
          "required": true,
          "description": "User email - PII but not PHI unless linked to patient",
          "annotations": ["@pii"]
        },
        "role": {
          "type": "UserRole",
          "required": true,
          "annotations": []
        },
        "permissions": {
          "type": "Array<Permission>",
          "annotations": []
        },
        "lastLoginAt": {
          "type": "Date",
          "annotations": []
        },
        "mfaEnabled": {
          "type": "boolean",
          "annotations": []
        }
      }
    },

    "UserRole": {
      "type": "enum",
      "values": ["admin", "physician", "nurse", "staff", "patient", "readonly"]
    },

    "Permission": {
      "type": "enum",
      "values": [
        "patient:read",
        "patient:write",
        "patient:delete",
        "medical_record:read",
        "medical_record:write",
        "appointment:read",
        "appointment:write",
        "audit:read",
        "admin:all"
      ]
    },

    "Session": {
      "type": "interface",
      "properties": {
        "id": {
          "type": "string",
          "annotations": []
        },
        "userId": {
          "type": "string",
          "annotations": []
        },
        "createdAt": {
          "type": "Date",
          "annotations": []
        },
        "expiresAt": {
          "type": "Date",
          "annotations": []
        },
        "ipAddress": {
          "type": "string",
          "annotations": ["@pii"]
        },
        "userAgent": {
          "type": "string",
          "annotations": []
        }
      }
    },

    "AuthService": {
      "type": "class",
      "description": "Authentication service with HIPAA-compliant session management",
      "methods": {
        "login": {
          "inputs": [
            {"name": "email", "type": "string"},
            {"name": "password", "type": "string"},
            {"name": "mfaCode", "type": "string"}
          ],
          "returns": {"type": "Promise", "inner": "Session"},
          "throws": ["InvalidCredentialsError", "MFARequiredError", "AccountLockedError"],
          "effects": ["audit.log"],
          "annotations": ["@authentication"]
        },
        "logout": {
          "inputs": [
            {"name": "sessionId", "type": "string"}
          ],
          "returns": {"type": "Promise", "inner": "void"},
          "effects": ["session.delete", "audit.log"],
          "annotations": []
        },
        "validateSession": {
          "inputs": [
            {"name": "sessionId", "type": "string"}
          ],
          "returns": {"type": "Promise", "inner": "User"},
          "throws": ["InvalidSessionError", "SessionExpiredError"],
          "effects": ["session.read"],
          "annotations": []
        },
        "checkPermission": {
          "inputs": [
            {"name": "userId", "type": "string"},
            {"name": "permission", "type": "Permission"}
          ],
          "returns": {"type": "Promise", "inner": "boolean"},
          "effects": [],
          "annotations": []
        },
        "resetPassword": {
          "inputs": [
            {"name": "email", "type": "string"}
          ],
          "returns": {"type": "Promise", "inner": "void"},
          "effects": ["audit.log"],
          "annotations": ["@authentication"]
        },
        "enableMFA": {
          "inputs": [
            {"name": "userId", "type": "string"}
          ],
          "returns": {"type": "Promise", "inner": "MFASetupResult"},
          "effects": ["database.write", "audit.log"],
          "annotations": ["@requires-auth"]
        }
      }
    }
  },

  "dependencies": {
    "audit": "^1.0.0"
  }
}
